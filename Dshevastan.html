<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Arbol de la vida</title>
  <style>
    .losInputs {
      position: absolute;
      left: 500px;
      top: 80px;
      width: 232px;
    }

    .losInputs3 {
      position: absolute;
      left: 800px;
      top: 80px;
      width: 232px;
    }

    .losInputs2 {
      position: absolute;
      left: 500px;
      top: 290px;
      width: 232px;
      padding: 12px;
    }

    .esencia {
      position: absolute;
      left: 800px;
      top: 310px;
      width: 232px;
    }

    .apartirde {
      position: absolute;
      left: 500px;
      top: 490px;
      width: 530px;
    }

    .apartirde table {
      width: -webkit-fill-available;
      width: inherit;
    }

    .apartirde table td {
      border: 0;
    }

    .apartirde table th {
      border: 0;

      text-decoration: underline;
    }

    .esmerilado {
      box-shadow: 0 0 1rem 0 rgba(0, 0, 0, 0.5);
      border-radius: 15px;
      background-color: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      padding: 20px;
    }

    .borde {
      background: hsla(0, 0%, 100%, 0.3);
      box-shadow: 0 8px 32px 0 rgb(31 38 135 / 37%);
      backdrop-filter: blur(1.5px);
      -webkit-backdrop-filter: blur(1.5px);
      border-radius: 10px;
      border: 4px solid hsla(0, 0%, 100%, 0.6);
    }

    .bordechico {
      background: hsla(0, 0%, 100%, 0.3);
      box-shadow: 0 8px 32px 0 rgb(31 38 135 / 37%);
      backdrop-filter: blur(1.5px);
      -webkit-backdrop-filter: blur(1.5px);
      border-radius: 10px;
      border: 4px solid hsla(0, 0%, 100%, 0.6);
      margin-top: 4px;
      margin-bottom: 4px;
    }

    .bordechico p {
      margin: 3px;
    }

    .v-input {
      flex: 1 1 auto;
      font-size: 16px;
      letter-spacing: normal;

      margin-top: 4px;

      max-width: 100%;
      width: auto;

      background-color: "snow";
      font: inherit;
      padding-left: 8px;
    }

    input,
    select {
      margin-left: 10px;
      outline: none;

      background-color: transparent;
      border-style: none;
      border-radius: 0;
      padding: 0.7 0 0 0;
      writing-mode: horizontal-tb !important;

      text-rendering: auto;

      letter-spacing: normal;
      word-spacing: normal;

      text-transform: none;
      text-indent: 0px;
      text-shadow: none;
      display: inline-block;
      text-align: start;
      appearance: auto;
      border: 0 !important;
      margin-top: 10px;
      margin-bottom: 10px;

      appearance: none;
    }

    .arbolsinuso {
      background-color: #0a1445;
    }

    .fondo {
      position: absolute;
      left: 0px;
      top: 0px;
      height: 750px;
      width: 800px;
      background-image: url(https://elarboldemivida.es/wp-content/uploads/2023/02/1500.jpg);
      background-size: 800px 800px;
      background-repeat: no-repeat;
      background-position: top left;

      background-position-x: -200px;
      background-position-y: -50px;
      opacity: 0.3;
    }

    #arbolCanvas {
      position: absolute;
      left: 20px;
      top: 19px;
    }

    .titulo {
      position: absolute;
      left: 700px;
      top: 650px;
      color: antiquewhite;
    }


    th,
    td {
      border: 1px solid;
      padding: 5px;
      color: honeydew;
    }
  </style>
</head>

<body>
  <div class="arbolsinuso">
    <div class="fondo"></div>
    <div class="titulo">
      <h3 style="color: red" id="muestraError">&nbsp;</h3>
    </div>
    <canvas id="arbolCanvas" width="500" height="700">
      Su navegador no admite el uso de Canvas</canvas>
    <div class="losInputs esmerilado">
      <div class="v-input borde" style="background-color: SNOW">
        <input class="inputletra" type="text" value="Nombre completo" name="nombre" style="padding: 0em" />
      </div>
      <div class="v-input borde" style="background-color: SNOW">
        <input class="inputletra" type="text" value="Primer apellido" name="apellido" style="padding: 0em" />
      </div>
      <div class="v-input borde" style="background-color: SNOW">
        <input class="inputletra" type="text" value="Segundo apellido" name="apellido2" style="padding: 0em" />
      </div>
    </div>
    <div class="esencia esmerilado">
      <div class=" bordechico" style="text-align: center; background-color: rgb(240, 243, 52)">
        <p>Esencia: <span id="esencia"></span></p>
      </div>
      <div class=" bordechico" style="text-align: center; background-color: rgb(240, 243, 52)">
        <p>Expresión: <span id="expresion"></span></p>
      </div>
      <div class=" bordechico" style="text-align: center; background-color: rgb(240, 243, 52)">
        <p>Camino de vida: <span id="caminodevida"></span></p>
      </div>


    </div>
    <div class="apartirde esmerilado">
      <table>
        <tr style="vertical-align: super;">
          <td>
            <table id="tablakarma">
              <th></th>




            </table>
          </td>
          <td>
            <table id="tablatalento">

              <th>Talentos a partir de</th>


            </table>
          </td>
        </tr>
      </table>


    </div>


  </div>

  <div class="losInputs3 esmerilado">
    <label style="color: white">
      Fecha de nacimiento:
      <div class="v-input borde" style="text-align: center; background-color: SNOW">
        <input class="inputletra" type="date" name="dia" />
      </div>
    </label>
    <div class="v-input borde" style="background-color: SNOW">
      <input class="inputletra" type="text" value="Segundo apellido paterno" id="apellido2P" style="padding: 0em" />
      <input type="checkbox" checked id="apellido2Pchek" style="appearance: auto;    " />
    </div>
    <div class="v-input borde" style="background-color: SNOW">
      <input class="inputletra" type="text" value="Segundo apellido materno" id="apellido2M"
        style="padding: 0em" /><input type="checkbox" checked id="apellido2Mchek"
        style="appearance: auto;    width: 20px" ; />
    </div>
  </div>

  <div class="losInputs2 esmerilado">
    <div class="v-input borde" style="background-color: SNOW">
      <select id="alfabeto" style="background-size: 0; padding-right: 0">
        <!-- style="width: 200px" -->
        <option value="Castellano94" selected>Castellano hasta 1994</option>
        <option value="Castellano95">Castellano desde 1995</option>
        <option value="internacional">Alfabeto internacional</option>
        <option value="italiano">Alfabeto Italiano</option>
        <option value="portugues">Alfabeto Portugués</option>
        <option value="aleman">Alfabeto alemán</option>
      </select>
    </div>
  </div>

  <div id="ficha" style="position: absolute; left: 1105px; top: 88px"></div>
  <div id="secreto" style="position: absolute; left: 1310px; top: 88px"></div>
  </div>
  <script>
    const fileSuelto = true;
    const color1 = "#15fad9";
    const color2 = "#ff1aff";
    const color3 = "#ffb900";
    const colorKarmaTriplicado = "red";
    let auxcolorpormodificaciones = color1;
    const colorfosforito = "#15fad9";
    const puntosRadio = 20;

    let v_alfabeto = "Castellano94";
    let v_nombre = "Alberto";
    let v_apellido1 = "martin";
    let v_apellido2 = "martin";
    let v_apellido2P;
    let v_apellido2M;
    let v_dia = 7;
    let v_mes = 7;
    let v_año = 1984;
    let muestraError = "";
    let v_caminodevida = 0;

    let ficha = [];
    let secreto = [];
    let fichaConSectreto = [
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    ];
    let flagFichaLlena = false;

    const alfabeto = [
      ["A", 1, 1],
      ["B", 2, 2],
      ["C", 3, 3],
      ["CH", 4, 4],
      ["D", 5, 5],
      ["E", 6, 6],
      ["F", 7, 7],
      ["G", 8, 8],
      ["H", 9, 9],
      ["I", 1, 10],
      ["J", 2, 20],
      ["K", 3, 30],
      ["L", 4, 40],
      ["LL", 5, 50],
      ["M", 6, 60],
      ["N", 7, 70],
      ["Ñ", 8, 80],
      ["O", 9, 90],
      ["P", 1, 100],
      ["Q", 2, 200],
      ["R", 3, 300],
      ["S", 4, 400],
      ["T", 5, 500],
      ["U", 6, 600],
      ["V", 7, 700],
      ["W", 8, 800],
      ["X", 9, 900],
      ["Y", 1, 1000],
      ["Z", 2, 2000],
      [" ", 0, 0],
    ];
    const Castellano95 = [
      ["A", 1, 1],
      ["B", 2, 2],
      ["C", 3, 3],
      ["D", 4, 4],
      ["E", 5, 5],
      ["F", 6, 6],
      ["G", 7, 7],
      ["H", 8, 8],
      ["I", 9, 9],
      ["J", 1, 10],
      ["K", 2, 20],
      ["L", 3, 30],
      ["M", 4, 40],
      ["N", 5, 50],
      ["Ñ", 6, 60],
      ["O", 7, 70],
      ["P", 8, 80],
      ["Q", 9, 90],
      ["R", 1, 100],
      ["S", 2, 200],
      ["T", 3, 300],
      ["U", 4, 400],
      ["V", 5, 500],
      ["W", 6, 600],
      ["X", 7, 700],
      ["Y", 8, 800],
      ["Z", 9, 900],
      [" ", 0, 0],
    ];
    const internacional = [
      ["A", 1, 1],
      ["B", 2, 2],
      ["C", 3, 3],
      ["D", 4, 4],
      ["E", 5, 5],
      ["F", 6, 6],
      ["G", 7, 7],
      ["H", 8, 8],
      ["I", 9, 9],
      ["J", 1, 10],
      ["K", 2, 20],
      ["L", 3, 30],
      ["M", 4, 40],
      ["N", 5, 50],

      ["O", 6, 60],
      ["P", 7, 70],
      ["Q", 8, 80],
      ["R", 9, 90],
      ["S", 1, 100],
      ["T", 2, 200],
      ["U", 3, 300],
      ["V", 4, 400],
      ["W", 5, 500],
      ["X", 6, 600],
      ["Y", 7, 700],
      ["Z", 8, 800],
      [" ", 0, 0],
    ];
    const italiano = [
      ["A", 1, 1],
      ["B", 2, 2],
      ["C", 3, 3],
      ["D", 4, 4],
      ["E", 5, 5],
      ["F", 6, 6],
      ["G", 7, 7],
      ["H", 9, 9],
      ["I", 8, 8],
      ["L", 1, 10],
      ["M", 2, 20],
      ["N", 3, 30],
      ["O", 4, 40],
      ["P", 5, 50],
      ["Q", 6, 60],
      ["R", 7, 70],
      ["S", 8, 80],
      ["T", 9, 90],
      ["U", 1, 100],
      ["V", 2, 200],
      ["Z", 3, 300],
      [" ", 0, 0],
    ];
    const portugues = [
      ["A", 1, 1],
      ["B", 2, 2],
      ["C", 3, 3],
      ["D", 4, 4],
      ["E", 5, 5],
      ["F", 6, 6],
      ["G", 7, 7],
      ["H", 8, 8],
      ["I", 9, 9],
      ["J", 1, 10],
      ["K", 2, 20],
      ["L", 3, 30],
      ["M", 4, 40],
      ["N", 5, 50],
      ["O", 6, 60],
      ["P", 7, 70],
      ["Q", 8, 80],
      ["R", 9, 90],
      ["S", 1, 100],
      ["T", 2, 200],
      ["U", 3, 300],
      ["V", 4, 400],
      ["X", 5, 500],
      ["Y", 6, 600],
      ["Z", 7, 700],
      [" ", 0, 0],
    ];
    const aleman = [
      ["A", 1, 1],
      ["B", 2, 2],
      ["C", 3, 3],
      ["D", 4, 4],
      ["E", 5, 5],
      ["F", 6, 6],
      ["G", 7, 7],
      ["H", 8, 8],
      ["I", 9, 9],
      ["J", 1, 10],
      ["K", 2, 20],
      ["L", 3, 30],
      ["M", 4, 40],
      ["N", 5, 50],
      ["O", 6, 60],
      ["P", 7, 70],
      ["Q", 8, 80],
      ["R", 9, 90],
      ["S", 1, 100],
      ["T", 2, 200],
      ["U", 3, 300],
      ["V", 4, 400],
      ["W", 5, 500],
      ["X", 6, 600],
      ["Z", 7, 700],
      [" ", 0, 0],
    ];

    const posiciones = [
      [70, 181],
      [134, 294],
      [134, 67],
      [265, 294],
      [265, 67],

      [330, 181],
      [396, 294],
      [396, 67],

      [461, 181],
      [592, 181],
    ];
    if (fileSuelto) {
      document.body.style.backgroundColor = "#0a1445";

      //document.getElementsByClassName("losInputs")[0].style.top =          posiciones[5][0] - 114 + "px";
      //document.getElementsByClassName("losInputs2")[0].style.top =          posiciones[5][0] - 114 + 283 + "px";
    }

    function llenarFicha() {
      v_nombre = desglosar(v_nombre)[0];
      ficha[1] = [numero(v_nombre), null, null];
      secreto[0] = numeroSecreto(v_nombre);

      v_apellido1 = desglosar(v_apellido1)[0];
      ficha[2] = [numero(v_apellido1), null, null];
      secreto[1] = numeroSecreto(v_apellido1);

      v_apellido2 = desglosar(v_apellido2)[0];
      ficha[3] = [numero(v_apellido2), null, null];
      secreto[2] = numeroSecreto(v_apellido2);

      ficha[4] = [reduccionA22(v_dia), null, null];
      ficha[5] = [parseInt(v_mes), null, null];
      ficha[6] = [reduccionA22(v_año), null, null];
      ficha[7] = [
        reduccionA22(ficha[1][0] + ficha[2][0] + ficha[3][0]),
        null,
        null,
      ];
      ficha[8] = [
        reduccionA22(ficha[4][0] + ficha[5][0] + ficha[6][0]),
        null,
        null,
      ];
      ficha[9] = [reduccionA22(ficha[7][0] + ficha[8][0]), null, null];
      ficha[10] = [reduccionA22(ficha[1][0] + ficha[2][0]), null, null];
      ficha[11] = [reduccionA22(ficha[2][0] + ficha[3][0]), null, null];
      ficha[12] = [reduccionA22(ficha[1][0] + ficha[3][0]), null, null];

      ficha[13] = [reduccionA22(ficha[4][0] + ficha[5][0]), null, null];
      ficha[14] = [reduccionA22(ficha[5][0] + ficha[6][0]), null, null];
      ficha[20] = [reduccionA22(ficha[10][0] + ficha[11][0] + ficha[12][0]), null, null];
      ficha[21] = [reduccionA22(ficha[13][0] + ficha[14][0]), null, null];
      ficha[22] = [reduccionA22(ficha[20][0] + ficha[21][0]), null, null];

      //Ahora completar familias de numeros
      for (let t = 1; t <= 14; t++) {
        ficha[t][1] = reduccionA9(ficha[t][0]);
        ficha[t][2] = reduccionA9(ficha[t][1]);
      }
      for (let t = 20; t <= 22; t++) {
        ficha[t][1] = reduccionA9(ficha[t][0]);
        ficha[t][2] = reduccionA9(ficha[t][1]);
      }

      // Ahora intento llenar las familias
      for (let qq = 7; qq <= 14; qq++) {
        if (ficha[qq][1] == null) {
          ficha[qq][1] = intentaLlenar(qq);
        } else if (ficha[qq][2] == null) {
          ficha[qq][2] = intentaLlenar(qq);
        }
      }
      for (let qq = 20; qq <= 22; qq++) {
        if (ficha[qq][1] == null) {
          ficha[qq][1] = intentaLlenar(qq);
        } else if (ficha[qq][2] == null) {
          ficha[qq][2] = intentaLlenar(qq);
        }
      }

      //ahora solo sobre las familias incompletas rellenamos con el numero secreto. sin repetidos
      for (let r = 1; r <= 3; r++) {
        if (!verifFamiliaCompleta(r)) {
          completaConSecreto(r);
        }
      }
      //ahora vuelvo a intentar completar la familia, el resultado tambien es secreto
      for (let qq = 7; qq <= 14; qq++) {
        if (ficha[qq][1] == null) {
          ficha[qq][1] = intentaLlenar(qq);
          fichaConSectreto[qq] = ficha[qq][1] || 0;
        } else if (ficha[qq][2] == null) {
          ficha[qq][2] = intentaLlenar(qq);
          fichaConSectreto[qq] = ficha[qq][2] || 0;
        }
      }
      for (let qq = 20; qq <= 22; qq++) {
        if (ficha[qq][1] == null) {
          ficha[qq][1] = intentaLlenar(qq);
          fichaConSectreto[qq] = ficha[qq][1] || 0;
        } else if (ficha[qq][2] == null) {
          ficha[qq][2] = intentaLlenar(qq);
          fichaConSectreto[qq] = ficha[qq][2] || 0;
        }
      }
      flagFichaLlena = true;
    }

    function completaConSecreto(cual) {
      let cualsecreto = secreto[cual - 1];

      let existe1 = ficha[cual][0];
      let existe2 = ficha[cual][1];
      let existe3 = ficha[cual][2];
      if (existe1 == cualsecreto) {
        return;
      }
      if (existe2 == cualsecreto) {
        return;
      }
      if (existe3 == cualsecreto) {
        return;
      }
      if (existe2 == null) {
        ficha[cual][1] = cualsecreto;
        fichaConSectreto[cual] = cualsecreto;
        return;
      } else {
        if (existe3 == null) {
          ficha[cual][2] = cualsecreto;
          fichaConSectreto[cual] = cualsecreto;
          return;
        }
      }
    }

    function verifFamiliaCompleta(cual) {
      let copia = [...ficha[cual]];
      copia.sort(function (a, b) {
        return b - a;
      });
      let existe1 = copia[0];
      let existe2 = copia[1];
      let existe3 = copia[2];
      switch (existe1) {
        case 22:
          if (existe2 == 14 && existe3 == 4) {
            return true;
          } else return false;
          break;
        case 21:
          if (existe2 == 12 && existe3 == 3) {
            return true;
          } else return false;
          break;
        case 20:
          if (existe2 == 11 && existe3 == 2) {
            return true;
          } else return false;
          break;
        case 19:
          if (existe2 == 10 && existe3 == 1) {
            return true;
          } else return false;
          break;
        case 18:
          if (existe2 == 9) {
            return true;
          } else return false;
          break;
        case 17:
          if (existe2 == 8) {
            return true;
          } else return false;
          break;
        case 16:
          if (existe2 == 7) {
            return true;
          } else return false;
          break;
        case 15:
          if (existe2 == 6) {
            return true;
          } else return false;
          break;
        case 14:
          if (existe2 == 5) {
            return true;
          } else return false;
          break;
        default:
          return false;
      }
    }

    function intentaLlenar(cual) {
      let existe1 = ficha[cual][0];
      let existe2 = ficha[cual][1] || 0;
      let existe3 = ficha[cual][2] || 0;
      let intento1;
      let intento2;
      let intento3;
      if (cual == 7) {
        intento1 = ficha[1];
        intento2 = ficha[2];
        intento3 = ficha[3];
        return combinacionesDeSumas3(
          intento1,
          intento2,
          intento3,
          existe1,
          existe2,
          existe3
        );
      }
      if (cual == 8) {
        intento1 = ficha[4];
        intento2 = ficha[5];
        intento3 = ficha[6];
        return combinacionesDeSumas3(
          intento1,
          intento2,
          intento3,
          existe1,
          existe2,
          existe3
        );
      }
      if (cual == 9) {
        intento1 = ficha[7];
        intento2 = ficha[8];
        return combinacionesDeSumas2(
          intento1,
          intento2,
          existe1,
          existe2,
          existe3
        );
      }
      if (cual == 10) {
        intento1 = ficha[1];
        intento2 = ficha[2];
        return combinacionesDeSumas2(
          intento1,
          intento2,
          existe1,
          existe2,
          existe3
        );
      }
      if (cual == 11) {
        intento1 = ficha[2];
        intento2 = ficha[3];
        return combinacionesDeSumas2(
          intento1,
          intento2,
          existe1,
          existe2,
          existe3
        );
      }
      if (cual == 12) {
        intento1 = ficha[4];
        intento2 = ficha[5];
        return combinacionesDeSumas2(
          intento1,
          intento2,
          existe1,
          existe2,
          existe3
        );
      }
      if (cual == 13) {
        intento1 = ficha[5];
        intento2 = ficha[6];
        return combinacionesDeSumas2(
          intento1,
          intento2,
          existe1,
          existe2,
          existe3
        );
      }
      if (cual == 14) {
        intento1 = ficha[5];
        intento2 = ficha[6];
        return combinacionesDeSumas2(
          intento1,
          intento2,
          existe1,
          existe2,
          existe3
        );
      }
      if (cual == 20) {
        intento1 = ficha[10];
        intento2 = ficha[11];
        intento3 = ficha[12];
        return combinacionesDeSumas3(
          intento1,
          intento2,
          intento3,
          existe1,
          existe2,
          existe3
        );
      }
      if (cual == 21) {
        intento1 = ficha[13];
        intento2 = ficha[14];
        return combinacionesDeSumas2(
          intento1,
          intento2,
          existe1,
          existe2,
          existe3
        );
      }
      if (cual == 22) {
        intento1 = ficha[20];
        intento2 = ficha[21];
        return combinacionesDeSumas2(
          intento1,
          intento2,
          existe1,
          existe2,
          existe3
        );
      }
    }

    function combinacionesDeSumas3(
      intento1,
      intento2,
      intento3,
      existe1,
      existe2,
      existe3
    ) {
      let resultado;
      for (let r = 0; r <= 2; r++) {
        if (intento1[r] == null) {
          break;
        }
        for (let s = 0; s <= 2; s++) {
          if (intento2[s] == null) {
            break;
          }
          for (let t = 0; t <= 2; t++) {
            if (intento3[t] == null) {
              break;
            }
            resultado = reduccionA22(intento1[r] + intento2[s] + intento3[t]);
            if (
              resultado != existe1 &&
              resultado != existe2 &&
              resultado != existe3
            ) {
              return resultado;
            }
          }
        }
      }
      return null;
    }
    function combinacionesDeSumas2(
      intento1,
      intento2,
      existe1,
      existe2,
      existe3
    ) {
      let resultado;
      for (let r = 0; r <= 2; r++) {
        if (intento1[r] == null) {
          break;
        }
        for (let s = 0; s <= 2; s++) {
          if (intento2[s] == null) {
            break;
          }
          resultado = reduccionA22(intento1[r] + intento2[s]);
          if (
            resultado != existe1 &&
            resultado != existe2 &&
            resultado != existe3
          ) {
            return resultado;
          }
        }
      }
      return null;
    }

    function numero(que) {
      return reduccionA22(desglosar(que)[1]);
    }
    function numeroSecreto(que) {
      return reduccionA22(desglosar(que)[2]);
    }

    function reduccionA9(que) {
      if (que > 22) {
        muestraError =
          "error de interpretacioon en los calculos, por favor avise al administrador";
        return;
      }
      if (que <= 9) return null;
      if (que == 19) return 10;
      let unidades = que % 10;
      let decenas = Math.trunc(que / 10) % 10;
      return unidades + decenas;
    }

    function reduccionA22(que) {
      if (que <= 22) return parseInt(que);
      let unidades = que % 10;
      let decenas = Math.trunc(que / 10) % 10;
      let centenas = Math.trunc(que / 100) % 10;
      let miles = Math.trunc(que / 1000) % 10;
      let decenamiles = Math.trunc(que / 10000) % 10;
      let centenamiles = Math.trunc(que / 100000) % 10;
      let millones = Math.trunc(que / 1000000) % 10;
      return parseInt(
        reduccionA22(
          unidades +
          decenas +
          centenas +
          miles +
          decenamiles +
          centenamiles +
          millones
        )
      );
    }
    function reduccionA0(que) {

      let unidades = que % 10;
      let decenas = Math.trunc(que / 10) % 10;
      let centenas = Math.trunc(que / 100) % 10;
      let miles = Math.trunc(que / 1000) % 10;

      return parseInt(

        unidades +
        decenas +
        centenas +
        miles


      );
    }


    function desglosar(que) {
      //que las letras esten en el alfabeto
      que = que.toUpperCase();
      que = eliminarDiacriticos(que);
      let sumaNormal = 0,
        sumaOculta = 0;
      let letra;

      switch (v_alfabeto) {
        case "Castellano94":
          alfabetoElegido = alfabeto;
          break;
        case "internacional":
          alfabetoElegido = internacional;
          que = quitarLetrsaNoEsten(que, alfabetoElegido);
          break;
        case "Castellano95":
          alfabetoElegido = Castellano95;
          break;
        case "italiano":
          alfabetoElegido = italiano;
          que = quitarLetrsaNoEsten(que, alfabetoElegido);
          break;
        case "portugues":
          alfabetoElegido = portugues;
          que = quitarLetrsaNoEsten(que, alfabetoElegido);
          break;
        case "aleman":
          alfabetoElegido = aleman;
          que = quitarLetrsaNoEsten(que, alfabetoElegido);
          break;
        default:
          alfabetoElegido = alfabeto;
          que = quitarLetrsaNoEsten(que, alfabetoElegido);
      }
      for (let t = 0; t < que.length; t++) {
        letra = que[t];
        if (v_alfabeto == "Castellano94") {
          if (letra == "C" && t < que.length - 1 && que[t + 1] == "H") {
            letra = "CH";
            t++;
          }
          if (letra == "L" && t < que.length - 1 && que[t + 1] == "L") {
            letra = "LL";
            t++;
          }
        }
        let puntero = 0;
        try {
          while (alfabetoElegido[puntero][0] != letra) {
            puntero++;
          }
        } catch {
          muestraError = "la letra " + letra + " no está en el diccionario";
          return;
        }

        sumaNormal = sumaNormal + alfabetoElegido[puntero][1];
        sumaOculta = sumaOculta + alfabetoElegido[puntero][2];
      }
      //console.log('filtrado: ', que);
      return [que, sumaNormal, sumaOculta];
    }
    function sumavocales(que) {
      //alfabetoElegido es ahora unn array global que lo llené al llamar a desglosa()
      que = que.toUpperCase();
      que = eliminarDiacriticos(que);

      let sumaNormal = 0;
      let letra;
      for (let t = 0; t < que.length; t++) {
        letra = que[t];
        if (["A", "E", "I", "O", "U"].includes(letra)) {
          let puntero = 0;

          while (alfabetoElegido[puntero][0] != letra) {
            puntero++;
          }
          sumaNormal = sumaNormal + alfabetoElegido[puntero][1];
        }
      }

      return sumaNormal;
    }
    function quitarLetrsaNoEsten(que, alfabetoElegido) {
      const texto = [...que];
      var result = "";
      let flag;
      texto.forEach((letra) => {
        flag = true;
        for (const item of alfabetoElegido) {
          if (item[0] === letra) {
            result = result + letra;
            flag = false;
            break;
          }
        }
        if (flag) {
          alert(
            "Se quitó la letra " + letra + " porque no está en el diccionario"
          );
        }
      });

      return result;
    }

    function eliminarDiacriticos(texto) {
      return texto
        .normalize("NFD")
        .replace(
          /([^n\u0300-\u036f]|n(?!\u0303(?![\u0300-\u036f])))[\u0300-\u036f]+/gi,
          "$1"
        )
        .normalize()
        .replace(/[^[A-ZÑ ]]*/g, "")
        .replace(/[[]*/g, "");
    }

    function dibujarFicha() {
      for (let t = 1; t <= 7; t++) {
        auxDibuja3(t, color1);
      }
      //ficha 8 en rojo
      auxDibuja3(8, color2);

      //ficha 9 en verde
      auxDibuja3(9, color3);

      //ficha 10 en linea discontinua
      auxDibuja3(10, color1, false, true);

      //ficha 11 con punto raya , la secreta con ondulacion punto ondulacion
      auxDibuja3(11, color1, false, true, 2);

      //ficha 13 con puntos finos
      auxDibuja3(13, color1, false, true, 3);

      //ficha 14 con puntos gruesos
      auxDibuja3(14, color1, false, true, 4);

      //ficha 12 como la 10
      auxDibuja3(12, color1, false, true);

      //ahora las lineas de karma
      let senderosexistentes = [];
      for (let t = 1; t <= 14; t++) {
        senderosexistentes = senderosexistentes.concat(ficha[t]);
      }
      let karma = [];
      let karmaduplicado = [];
      let karmatriplicado = [];
      karma = ficha[20].concat(ficha[21].concat(ficha[22])); ///para sumar arrays
      //console.log(karma);
      ///todo duplicado lo pongo en karmaduplicado
      for (var i = karma.length - 1; i >= 0; i--) {
        if (karma.indexOf(karma[i]) !== i) {
          karmaduplicado.push(karma[i]);
          karma.splice(i, 1); //me adelanto quitando uno de los duplicados
        }
      }

      //ahora, en karmaduplicado puede estar mas de una vez, lo reduzco
      /*
                // No, en la nueva version no lo reduzco sino que lo mando a triplicado
                for (var i = karmaduplicado.length - 1; i >= 0; i--) {
                    if (karmaduplicado.indexOf(karmaduplicado[i]) !== i) {
                        karmaduplicado.splice(i, 1);
                    }
                }
                */
      for (var i = karmaduplicado.length - 1; i >= 0; i--) {
        if (karmaduplicado.indexOf(karmaduplicado[i]) !== i) {
          karmatriplicado.push(karmaduplicado[i]);
          karmaduplicado.splice(i, 1); //me adelanto quitando uno de los duplicados
        }
      }

      //ahora quito los nulos, hay max 1 solo en cada array
      if (karma.indexOf(null) != -1) karma.splice(karma.indexOf(null), 1);
      if (karmaduplicado.indexOf(null) != -1)
        karmaduplicado.splice(karmaduplicado.indexOf(null), 1);
      if (karmatriplicado.indexOf(null) != -1)
        karmatriplicado.splice(karmatriplicado.indexOf(null), 1);
      //ahora quito en karma todos los que esten en karmaduplicado y triplicado.  luego quito de duplicado los que esten en triplicado. es de esta manera porque es una modificacion al codigo existente
      for (var d = karmaduplicado.length - 1; d >= 0; d--) {
        if (karma.indexOf(karmaduplicado[d]) != -1)
          karma.splice(karma.indexOf(karmaduplicado[d]), 1);
      }
      for (var d = karmatriplicado.length - 1; d >= 0; d--) {
        if (karma.indexOf(karmatriplicado[d]) != -1)
          karma.splice(karma.indexOf(karmatriplicado[d]), 1);
        if (karmaduplicado.indexOf(karmatriplicado[d]) != -1)
          karmaduplicado.splice(
            karmaduplicado.indexOf(karmatriplicado[d]),
            1
          );
      }

      // console.log("ficha:", ficha);
      //console.log("karma ", karma);
      //console.log("karmaduplicado ", karmaduplicado);
      //console.log("karmatriplicado ", karmatriplicado);

      karma.forEach((cada) => {
        if (senderosexistentes.indexOf(cada) == -1) {
          //el sendero no esta ocupado entonces dibujo el camino
          dibujaKarma(cada);
        } else {
          // dibujo un + sobre el sendero
          poneSimboloSuma(cada);
        }
      });
      karmaduplicado.forEach((cada) => {
        if (senderosexistentes.indexOf(cada) == -1) {
          dibujaKarmaDuplicado(cada);
        } else {
          poneSimboloSumaduplicado(cada);
        }
      });
      karmatriplicado.forEach((cada) => {
        if (senderosexistentes.indexOf(cada) == -1) {
          dibujaKarmaTriplicado(cada);
        } else {
          auxcolorpormodificaciones = colorKarmaTriplicado;
          poneSimboloSumaduplicado(cada);
          auxcolorpormodificaciones = color1;
        }
      });
      ponecirculos();
      dibujaRecuadro();
      ponenumerosendero();

      //console.log(ficha);

      if (fileSuelto) {
        poneTabla();
      }
      //;
    }
    function auxponeSimboloSuma(x, y) {
      //console.warn(ctx);
      ctx.save();
      ctx.beginPath();
      ctx.strokeStyle = auxcolorpormodificaciones;

      ctx.lineWidth = 2;
      ctx.setLineDash([]);
      ctx.moveTo(x, y);
      ctx.lineTo(x, y + 10);
      ctx.moveTo(x - 5, y + 5);
      ctx.lineTo(x + 5, y + 5);
      ctx.stroke();
      ctx.restore();
    }
    function poneSimboloSuma(sendero) {
      switch (sendero) {
        case 1:
          auxponeSimboloSuma(110, 85);
          break;
        case 2:
          auxponeSimboloSuma(197, 187);
          break;
        case 3:
          auxponeSimboloSuma(125, 147);
          break;
        case 4:
          auxponeSimboloSuma(235, 200);
          break;
        case 5:
          auxponeSimboloSuma(312, 187);
          break;
        case 6:
          auxponeSimboloSuma(127, 200);
          break;
        case 7:
          auxponeSimboloSuma(50, 187);
          break;
        case 8:
          auxponeSimboloSuma(163, 242);
          break;
        case 9:
          auxponeSimboloSuma(250, 305);
          break;
        case 10:
          auxponeSimboloSuma(312, 317);
          break;
        case 11:
          auxponeSimboloSuma(110, 305);

          break;
        case 12:
          auxponeSimboloSuma(50, 317);
          break;
        case 13:
          auxponeSimboloSuma(250, 345);
          break;
        case 14:
          auxponeSimboloSuma(198, 365);
          break;
        case 15:
          auxponeSimboloSuma(110, 345);
          break;
        case 16:
          auxponeSimboloSuma(135, 373);
          break;
        case 17:
          auxponeSimboloSuma(230, 410);
          break;
        case 18:
          auxponeSimboloSuma(265, 470);
          break;
        case 19:
          auxponeSimboloSuma(110, 435);
          break;
        case 20:
          auxponeSimboloSuma(97, 470);
          break;
        case 21:
          auxponeSimboloSuma(165, 485);
          break;
        case 22:
          auxponeSimboloSuma(255, 85);
          break;
      }
    }
    function poneSimboloSumaduplicado(sendero) {
      switch (sendero) {
        case 1:
          auxponeSimboloSuma(107, 85);
          auxponeSimboloSuma(97, 85);
          break;
        case 2:
          auxponeSimboloSuma(197, 187);
          auxponeSimboloSuma(207, 187);
          break;
        case 3:
          auxponeSimboloSuma(125, 147);
          auxponeSimboloSuma(115, 147);
          break;
        case 4:
          auxponeSimboloSuma(235, 200);
          auxponeSimboloSuma(225, 200);
          break;
        case 5:
          auxponeSimboloSuma(312, 187);
          auxponeSimboloSuma(322, 187);
          break;
        case 6:
          auxponeSimboloSuma(127, 200);
          auxponeSimboloSuma(137, 200);
          break;
        case 7:
          auxponeSimboloSuma(50, 187);
          auxponeSimboloSuma(40, 187);
          break;
        case 8:
          auxponeSimboloSuma(163, 242);
          auxponeSimboloSuma(153, 242);
          break;
        case 9:
          auxponeSimboloSuma(250, 305);
          auxponeSimboloSuma(260, 305);
          break;
        case 10:
          auxponeSimboloSuma(312, 317);
          auxponeSimboloSuma(322, 317);
          break;
        case 11:
          auxponeSimboloSuma(110, 305);
          auxponeSimboloSuma(100, 305);
          break;
        case 12:
          auxponeSimboloSuma(50, 317);
          auxponeSimboloSuma(40, 317);
          break;
        case 13:
          auxponeSimboloSuma(250, 345);
          auxponeSimboloSuma(260, 345);
          break;
        case 14:
          auxponeSimboloSuma(198, 365);
          auxponeSimboloSuma(208, 365);
          break;
        case 15:
          auxponeSimboloSuma(110, 345);
          auxponeSimboloSuma(100, 345);
          break;
        case 16:
          auxponeSimboloSuma(135, 373);
          auxponeSimboloSuma(145, 373);
          break;
        case 17:
          auxponeSimboloSuma(230, 410);
          auxponeSimboloSuma(220, 410);
          break;
        case 18:
          auxponeSimboloSuma(265, 470);
          auxponeSimboloSuma(275, 470);
          break;
        case 19:
          auxponeSimboloSuma(110, 435);
          auxponeSimboloSuma(120, 435);
          break;
        case 20:
          auxponeSimboloSuma(97, 470);
          auxponeSimboloSuma(87, 470);
          break;
        case 21:
          auxponeSimboloSuma(165, 485);
          auxponeSimboloSuma(155, 485);
          break;
        case 22:
          auxponeSimboloSuma(255, 85);
          auxponeSimboloSuma(265, 85);
          break;
      }
    }

    function auxDibuja3(
      t,
      color,
      zig = false,
      discontinua = false,
      dashType = 1
    ) {
      dibujaLinea(ficha[t][0], color, false, discontinua, dashType);
      if (ficha[t][1] != null) {
        if (ficha[t][1] == fichaConSectreto[t])
          dibujaLinea(ficha[t][1], color, true, discontinua, dashType);
        else dibujaLinea(ficha[t][1], color, false, discontinua, dashType);
      }
      if (ficha[t][2] != null) {
        if (ficha[t][2] == fichaConSectreto[t])
          dibujaLinea(ficha[t][2], color, true, discontinua, dashType);
        else dibujaLinea(ficha[t][2], color, false, discontinua, dashType);
      }
    }

    function dibujaLinea(
      cual,
      color,
      zig = false,
      dash = false,
      dashType = 1
    ) {
      //console.log(cual, zig);
      //cuando hay mas de una linea, que se dibujen una al lado de la otra, si es impar sera a la izq de la pricipal
      let separacionOffset = 5;
      let offset =
        Math.pow(-1, linea[cual]) *
        separacionOffset *
        Math.ceil(linea[cual] / 2);
      //console.log("cuantos:", linea[cual], offset);
      linea[cual]++;
      switch (cual) {
        case 1:
          punto[1].cuantos++;
          punto[3].cuantos++;
          new Line(punto[1], punto[3], zig, dash).draw(
            dashType,
            ctx,
            color,
            offset * 0.5,
            offset * 0.8
          );
          break;
        case 2:
          punto[1].cuantos++;
          punto[6].cuantos++;
          new Line(punto[1], punto[6], zig, dash).draw(
            dashType,
            ctx,
            color,
            offset
          );
          break;
        case 3:
          punto[2].cuantos++;
          punto[3].cuantos++;
          new Line(punto[2], punto[3], zig, dash).draw(
            dashType,
            ctx,
            color,
            0,
            offset
          );
          break;
        case 4:
          punto[2].cuantos++;
          punto[6].cuantos++;
          new Line(punto[2], punto[6], zig, dash).draw(
            dashType,
            ctx,
            color,
            offset * 0.8,
            offset * 0.5
          );
          break;
        case 5:
          punto[2].cuantos++;
          punto[4].cuantos++;
          new Line(punto[2], punto[4], zig, dash).draw(
            dashType,
            ctx,
            color,
            offset
          );
          break;
        case 6:
          punto[3].cuantos++;
          punto[6].cuantos++;
          new Line(punto[3], punto[6], zig, dash).draw(
            dashType,
            ctx,
            color,
            offset * -0.8,
            offset * 0.5
          );
          break;
        case 7:
          punto[5].cuantos++;
          punto[3].cuantos++;
          new Line(punto[5], punto[3], zig, dash).draw(
            dashType,
            ctx,
            color,
            offset,
            0
          );
          break;
        case 8:
          punto[4].cuantos++;
          punto[5].cuantos++;
          new Line(punto[4], punto[5], zig, dash).draw(
            dashType,
            ctx,
            color,
            0,
            offset
          );
          break;
        case 9:
          punto[4].cuantos++;
          punto[6].cuantos++;
          new Line(punto[4], punto[6], zig, dash).draw(
            dashType,
            ctx,
            color,
            offset * 0.5,
            offset * 0.8
          );
          break;
        case 10:
          punto[4].cuantos++;
          punto[7].cuantos++;
          new Line(punto[4], punto[7], zig, dash).draw(
            dashType,
            ctx,
            color,
            offset
          );
          break;
        case 11:
          punto[5].cuantos++;
          punto[6].cuantos++;
          new Line(punto[6], punto[5], zig, dash).draw(
            dashType,
            ctx,
            color,
            offset * -0.5,
            offset * 0.8
          );
          break;
        case 12:
          punto[5].cuantos++;
          punto[8].cuantos++;
          new Line(punto[8], punto[5], zig, dash).draw(
            dashType,
            ctx,
            color,
            offset
          );
          break;
        case 13:
          punto[7].cuantos++;
          punto[6].cuantos++;
          new Line(punto[6], punto[7], zig, dash).draw(
            dashType,
            ctx,
            color,
            offset * -0.5,
            offset * 0.8
          );
          break;
        case 14:
          punto[9].cuantos++;
          punto[6].cuantos++;
          new Line(punto[9], punto[6], zig, dash).draw(
            dashType,
            ctx,
            color,
            offset
          );
          break;
        case 15:
          punto[8].cuantos++;
          punto[6].cuantos++;
          new Line(punto[6], punto[8], zig, dash).draw(
            dashType,
            ctx,
            color,
            offset * 0.5,
            offset * 0.8
          );
          break;
        case 16:
          punto[7].cuantos++;
          punto[8].cuantos++;
          new Line(punto[7], punto[8], zig, dash).draw(
            dashType,
            ctx,
            color,
            0,
            offset
          );
          break;
        case 17:
          punto[7].cuantos++;
          punto[9].cuantos++;
          new Line(punto[7], punto[9], zig, dash).draw(
            dashType,
            ctx,
            color,
            offset * 0.5,
            offset * 0.8
          );
          break;
        case 18:
          punto[7].cuantos++;
          punto[10].cuantos++;
          new Line(punto[7], punto[10], zig, dash).draw(
            dashType,
            ctx,
            color,
            offset * 0.8,
            offset * 0.5
          );
          break;
        case 19:
          punto[8].cuantos++;
          punto[9].cuantos++;
          new Line(punto[8], punto[9], zig, dash).draw(
            dashType,
            ctx,
            color,
            offset * -0.5,
            offset * 0.8
          );
          break;

        case 20:
          punto[10].cuantos++;
          punto[8].cuantos++;
          new Line(punto[8], punto[10], zig, dash).draw(
            dashType,
            ctx,
            color,
            offset * 0.5,
            offset * -0.8
          );
          break;
        case 21:
          punto[10].cuantos++;
          punto[9].cuantos++;
          new Line(punto[9], punto[10], zig, dash).draw(
            dashType,
            ctx,
            color,
            offset
          );
          break;
        case 22:
          punto[1].cuantos++;
          punto[2].cuantos++;
          new Line(punto[2], punto[1], zig, dash).draw(
            dashType,
            ctx,
            color,
            offset * -0.5,
            offset * 0.8
          );
          break;
        default:
          return false;
      }
      //ponecirculos();
      //console.log('linea', linea[19]);
    }
    function dibujaKarmaaux(desde, hasta, offsetx = 1, offsety = 1) {
      //ejemplo linea torcida de estrellas
      let xx = (length * 2.6) / 2;
      let region = new Path2D();
      let to = hasta;
      let from = desde;

      let lineRadians = Math.atan2(to.y - from.y, to.x - from.x);
      const a = from.x - to.x;
      const b = from.y - to.y;
      let lineLength = Math.sqrt(a * a + b * b);

      ctx.save();
      ctx.beginPath();
      ctx.translate(from.x + xx * offsetx, from.y + xx * offsety);
      ctx.rotate(lineRadians);
      ctx.moveTo(0, 0);

      region.moveTo(0, 0);
      region.lineTo(0, 0 + xx * 2);
      region.lineTo(lineLength, 0 + xx * 2);
      region.lineTo(lineLength, 0);
      region.lineTo(0, 0);
      region.closePath();

      ctx.fill(region);
      ctx.restore();
    }

    function dibujaKarma(cual, duplicado = false, triplicado = false) {
      if (duplicado) ctx.fillStyle = asteriscopattern;
      else if (triplicado) ctx.fillStyle = karma3pattern;
      else ctx.fillStyle = estrellapattern;
      linea[cual]++;
      switch (cual) {
        case 1:
          dibujaKarmaaux(punto[1], punto[3], 0.5, 0.8);
          break;
        case 2:
          dibujaKarmaaux(punto[1], punto[6]);
          break;
        case 3:
          dibujaKarmaaux(punto[2], punto[3]);
          break;
        case 4:
          dibujaKarmaaux(punto[2], punto[6], 0.8, 0.5);
          break;
        case 5:
          dibujaKarmaaux(punto[2], punto[4]);
          break;
        case 6:
          dibujaKarmaaux(punto[3], punto[6], 0.8, -0.5);
          break;
        case 7:
          dibujaKarmaaux(punto[3], punto[5]);
          break;
        case 8:
          dibujaKarmaaux(punto[4], punto[5]);
          break;
        case 9:
          dibujaKarmaaux(punto[4], punto[6], 0.5, 0.8);
          break;
        case 10:
          dibujaKarmaaux(punto[4], punto[7]);
          break;
        case 11:
          dibujaKarmaaux(punto[6], punto[5], -0.5, 0.8);
          break;
        case 12:
          dibujaKarmaaux(punto[5], punto[8]);
          break;
        case 13:
          dibujaKarmaaux(punto[7], punto[6], -0.5, 0.8);
          break;
        case 14:
          dibujaKarmaaux(punto[6], punto[9]);
          break;
        case 15:
          dibujaKarmaaux(punto[6], punto[8], 0.5, 0.8);
          break;
        case 16:
          dibujaKarmaaux(punto[7], punto[8]);
          break;
        case 17:
          dibujaKarmaaux(punto[7], punto[9], 0.5, 0.8);
          break;
        case 18:
          dibujaKarmaaux(punto[7], punto[10], 0.8, 0.5);
          break;
        case 19:
          dibujaKarmaaux(punto[9], punto[8], -0.5, 0.8);
          break;
        case 20:
          dibujaKarmaaux(punto[8], punto[10], 0.8, -0.5);
          break;
        case 21:
          dibujaKarmaaux(punto[9], punto[10]);
          break;
        case 22:
          dibujaKarmaaux(punto[2], punto[1], -0.5, 0.8);
          break;
        default:
          return false;
      }
      //ponecirculos();
      //console.log('linea', linea[19]);
    }

    function dibujaKarmaDuplicado(cual) {
      dibujaKarma(cual, true);
    }
    function dibujaKarmaTriplicado(cual) {
      dibujaKarma(cual, false, true);
    }
    function clear() {
      linea = [
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      ];
      for (let p = 0; p < posiciones.length; p++) {
        punto[p + 1].cuantos = 0;
      }
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ponecirculos();
      v_caminodevida = 0;
      let donde = document.getElementById("tablakarma");
      donde.innerHTML = "";
      let th = document.createElement("th");
      th.innerHTML = "Karmas hasta la edad de";
      donde.appendChild(th);
      donde = document.getElementById("tablatalento");
      donde.innerHTML = "";
      th = document.createElement("th");
      th.innerHTML = "Talentos a partir de";
      donde.appendChild(th);

    }

    function Dshevastan() {


      if (apellido2Pchek.checked == true) {
        dibujaLinea(reduccionA22(desglosar(apellido2P.value)[1]), color1, false, false, 1);
      }
      if (apellido2Mchek.checked == true) {
        dibujaLinea(reduccionA22(desglosar(apellido2M.value)[1]), color1, false, false, 1);
      }


      esencia();
      expresion();
      caminodevida();


    }
    function esencia() {
      let vocales =
        sumavocales(v_nombre) +
        sumavocales(v_apellido1) +
        sumavocales(v_apellido2);
      vocales = reduccionA0(vocales);
      document.getElementById("esencia").innerHTML = vocales;
    }
    function expresion() {
      let consonantes =
        desglosar(v_nombre)[1] -
        sumavocales(v_nombre) +
        desglosar(v_apellido1)[1] -
        sumavocales(v_apellido1) +
        desglosar(v_apellido2)[1] -
        sumavocales(v_apellido2);

      document.getElementById("expresion").innerHTML = consonantes;
    }
    function caminodevida() {
      v_caminodevida = reduccionA0(parseInt(v_dia)) + reduccionA0(parseInt(v_mes)) + reduccionA0(parseInt(v_año));
      if (v_caminodevida > 36) {
        //res = reduccionA0(res);
        v_caminodevida = v_caminodevida - 9;
      }



      document.getElementById("caminodevida").innerHTML = v_caminodevida;
    }
    function TalentoKarma() {

      //por cada uno de los elementos de los 3 ultimos bloques, veo si se repiten entre los bloques 1 a 14
      let busco;
      let encontrado = false;
      for (let b = 20; b <= 22; b++) {
        for (let i = 0; i < 3; i++) {

          busco = ficha[b][i];
          encontrado = false;
          if (busco > 0 && busco <= 22) {


            let x = 1;
            while (x <= 14) {
              if (busco == ficha[x][0]
                || busco == ficha[x][1]
                || busco == ficha[x][2]
              ) {
                AgregarTalento(busco, v_caminodevida + (b - 20) * 9 + i * 3);
                x = 99;
                encontrado = true;
              }
              x++;
            }
            if (!encontrado) {
              AgregarKarma(busco, v_caminodevida + (b - 20) * 9 + i * 3);
            }
          }
        }
      }
    }
    function AgregarTalento(sendero, edad) {
      //console.log("talento:", sendero, edad);
      donde = document.getElementById("tablatalento");
      let tr = document.createElement("tr");
      let td = document.createElement("td");
      td.innerHTML = "S" + sendero + " desde los " + edad + "años";
      tr.appendChild(td);
      donde.appendChild(tr);
    }
    function AgregarKarma(sendero, edad) {
      //console.log("karma:", sendero, edad);
      donde = document.getElementById("tablakarma");
      let tr = document.createElement("tr");
      let td = document.createElement("td");
      td.innerHTML = "S" + sendero + " hasta los " + edad + "años";
      tr.appendChild(td);
      donde.appendChild(tr);
    }
    function ponecirculos() {
      var innerRadius = 5;

      let gradient;
      for (let p = 0; p < posiciones.length; p++) {
        ctx.beginPath();
        ctx.arc(
          posiciones[p][1],
          posiciones[p][0],
          puntosRadio,
          0,
          2 * Math.PI
        );
        gradient = ctx.createRadialGradient(
          posiciones[p][1],
          posiciones[p][0],
          innerRadius,
          posiciones[p][1],
          posiciones[p][0],
          puntosRadio
        );
        gradient.addColorStop(0, colorfosforito);
        gradient.addColorStop(1, "blue");
        ctx.setLineDash([]);
        ctx.lineWidth = 2;
        ctx.strokeStyle = "white";
        ctx.fillStyle = colorfosforito;
        ctx.fill();

        // ctx.lineWidth = 3;
        ctx.stroke();
      }
    }

    function ponenumerosendero() {
      const pos = [
        [106, 117, 1],
        [106, 245, 22],
        [134, 134, 3],
        [396, 134, 16],
        [265, 164, 8],
        [200, 67, 7],
        [200, 294, 5],
        [331, 294, 10],
        [331, 67, 12],
        [200, 181, 2],
        [220, 245, 4],
        [220, 117, 6],

        [295, 245, 9],
        [295, 117, 11],
        [365, 245, 13],
        [365, 117, 15],
        [425, 245, 17],
        [425, 117, 19],

        [480, 245, 18],
        [480, 117, 20],
        [370, 181, 14],
        [500, 181, 21],
      ];

      let diam = puntosRadio / 2;
      let gap = diam / 2;
      let gapx = gap;
      let gapy = gap - 1;

      for (let p = 0; p < pos.length; p++) {
        ctx.font = "12px sans-serif";
        if (pos[p][2] < 10) {
          //     ctx.font = "16px Arial";
          gapx = gap - 2;
          //gapy = gap;
        } else {
          //     if (pos[p][2] < 20) {
          // ctx.font = "12px Arial";
          gapx = gap + 2;
          //gapy = gap;
          //     } else {
          //         ctx.font = "10px Arial";
          //         gapx = gap;
          //         gapy = gap - 2;
          //     }
        }

        ctx.beginPath();
        ctx.arc(pos[p][1], pos[p][0], diam, 0, 2 * Math.PI);
        ctx.fillStyle = "white";
        ctx.fill();
        ctx.setLineDash([]);
        ctx.lineWidth = 1;
        ctx.strokeStyle = "black";
        ctx.strokeText(pos[p][2], pos[p][1] - gapx, pos[p][0] + gapy);

        //ctx.stroke();
      }
    }

    function dibujaRecuadro() {
      for (let cual = 1; cual <= 10; cual++) {
        switch (cual) {
          case 1:
            dibujaRecuadroaux(170, 28 + 53, punto[cual].cuantos, 3);
            //dibujaRecuadroaux(170, 28, punto[cual].cuantos, 3);

            break;
          case 2:
            dibujaRecuadroaux(294 - 10, 134 + 10, punto[cual].cuantos, 4);
            //dibujaRecuadroaux(294 + 45, 134 + 7, punto[cual].cuantos, 4);
            break;
          case 3:
            dibujaRecuadroaux(67 - 10, 134 + 10, punto[cual].cuantos, 4);
            //dibujaRecuadroaux(67 - 65, 134 + 7, punto[cual].cuantos, 4);
            break;
          case 4:
            dibujaRecuadroaux(294 - 10, 265 + 10, punto[cual].cuantos, 4);
            //dibujaRecuadroaux(294 + 45, 265 + 7, punto[cual].cuantos, 4);
            //     dibujaRecuadroaux(294 - 10, 265 + 7, , 4);
            break;
          case 5:
            dibujaRecuadroaux(67 - 10, 265 + 10, punto[cual].cuantos, 4);
            //dibujaRecuadroaux(67 - 65, 265 + 7, punto[cual].cuantos, 4);
            break;
          case 6:
            dibujaRecuadroaux(182 - 10, 330 + 10, punto[cual].cuantos, 8);
            //dibujaRecuadroaux(182 + 55, 330 + 7, punto[cual].cuantos, 8);
            break;
          case 7:
            dibujaRecuadroaux(294 - 10, 396 + 10, punto[cual].cuantos, 5);
            //dibujaRecuadroaux(294 + 45, 396 + 7, punto[cual].cuantos, 5);
            break;
          case 8:
            dibujaRecuadroaux(67 - 10, 396 + 10, punto[cual].cuantos, 5);
            //dibujaRecuadroaux(67 - 65, 396 + 7, punto[cual].cuantos, 5);
            break;
          case 9:
            dibujaRecuadroaux(182 - 10, 461 + 10, punto[cual].cuantos, 4);
            //dibujaRecuadroaux(182 + 45, 461 + 7, punto[cual].cuantos, 4);
            break;
          case 10:
            dibujaRecuadroaux(182 - 10, 592 + 10, punto[cual].cuantos, 3);
            //dibujaRecuadroaux(182 + 55, 592 + 7, punto[cual].cuantos, 3);
            break;

          default:
            return false;
        }
      }
    }

    function dibujaRecuadroaux(x, y, numerador, denominador) {
      // let tamaño = 20;
      // ctx.save();
      // ctx.beginPath();
      // ctx.strokeStyle = "white";
      // ctx.font = '10px Courier New';
      // ctx.lineWidth = 1;
      // ctx.setLineDash([]);
      // ctx.moveTo(x, y);
      // ctx.lineTo(x + tamaño, y);
      // ctx.lineTo(x + tamaño, y - tamaño);
      // ctx.lineTo(x, y - tamaño);
      // ctx.lineTo(x, y);
      // ctx.lineTo(x + tamaño, y - tamaño);
      // ctx.strokeText(numerador, x + 2, y - tamaño + 8);
      // ctx.strokeText(denominador, x + tamaño - 8, y - 3);
      // ctx.stroke();
      // ctx.restore();

      let tamaño = 20;
      let chico = tamaño / 2;
      let aux = numerador < 10 ? chico - 4 : chico - 9;
      ctx.beginPath();
      ctx.strokeStyle = "black";
      ctx.font = "14px sans-serif";
      ctx.lineWidth = 1;
      ctx.setLineDash([]);
      ctx.moveTo(x + 1, y - chico);
      ctx.lineTo(x + tamaño - 2, y - chico);
      //ctx.lineTo(x + tamaño, y - tamaño);
      ctx.strokeText(numerador, x + aux, y - chico - 3);
      ctx.strokeText(denominador, x + chico - 4, y + 3);
      ctx.stroke();
    }

    function poneTabla() {
      let table = document.getElementById("ficha");
      table.innerHTML = "";

      for (let b = 1; b <= 14; b++) {
        let tr = document.createElement("tr");
        let td = document.createElement("td");
        td.style.color = "#AA00AA";
        td.style.width = "18px";
        td.innerHTML = b;
        tr.appendChild(td);
        for (let i = 0; i < 3; i++) {
          let td = document.createElement("td");
          td.style.width = "18px";
          let span = document.createElement("span");
          span.innerHTML = ficha[b][i];
          if (ficha[b][i] == fichaConSectreto[b]) {
            span.style.fontStyle = "italic";
            span.style.color = "red";
          }
          td.appendChild(span);
          tr.appendChild(td);
        }

        table.appendChild(tr);
        if ([3, 6, 9, 12, 14].includes(b)) {
          table.appendChild(document.createElement("p"));
        }
      }

      for (let b = 20; b <= 22; b++) {
        let tr = document.createElement("tr");
        let td = document.createElement("td");
        td.style.color = "#AA00AA";
        td.style.width = "18px";
        td.innerHTML = String.fromCharCode(b + 45);
        tr.appendChild(td);
        for (let i = 0; i < 3; i++) {
          let td = document.createElement("td");
          td.style.width = "18px";
          let span = document.createElement("span");
          span.innerHTML = ficha[b][i];
          if (ficha[b][i] == fichaConSectreto[b]) {
            span.style.fontStyle = "italic";
            span.style.color = "red";
          }
          td.appendChild(span);
          tr.appendChild(td);
        }

        table.appendChild(tr);
      }
      /*  ya no dibujo una seccion para el numero secreto sino que lo pongo en rojo e italica dentro de la tabla
            let secreto = document.getElementById("secreto");
            secreto.innerHTML = "";
 
            for (let b = 1; b <= 13; b++) {
              let tr = document.createElement("tr");
 
              let td = document.createElement("td");
              td.innerHTML = fichaConSectreto[b];
              tr.appendChild(td);
 
              secreto.appendChild(tr);
            }
 
            for (let b = 20; b <= 22; b++) {
              let tr = document.createElement("tr");
 
              let td = document.createElement("td");
              td.innerHTML = fichaConSectreto[b];
              tr.appendChild(td);
 
              secreto.appendChild(tr);
            }
      */
    }

    class Point {
      constructor(x, y) {
        this.x = x;
        this.y = y;
        this.cuantos = 0;
      }
    }
    let linea = [
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    ];

    let punto = [];
    for (let p = 0; p < posiciones.length; p++) {
      punto[p + 1] = new Point(posiciones[p][1], posiciones[p][0]);
    }
    class Line {
      constructor(
        fromPoint = null,
        toPoint = null,
        zigZagged = false,
        dashed = false
      ) {
        this.from = fromPoint;
        this.to = toPoint;
        this.dashed = dashed;
        this.zigZagged = zigZagged;

        this.prepareZigZag();
      }

      setFrom(point) {
        this.from = point;
      }

      setTo(point) {
        this.to = toPoint;
      }

      getFrom() {
        return this.from;
      }

      getTo() {
        return this.to;
      }

      prepareZigZag() {
        // Get the radian angle of the line
        this.lineRadians = Math.atan2(
          this.to.y - this.from.y,
          this.to.x - this.from.x
        );

        // Get the length of the line
        const a = this.from.x - this.to.x;
        const b = this.from.y - this.to.y;
        this.lineLength = Math.sqrt(a * a + b * b);

        // 10 pixels between each zig zag "wave"
        this.zigzagSpacing = 5;

        // Length of one zig zag line - will in reality be doubled see below usage
        this.oneZigZagLength = 1;

        //Length of the last straight bit - so we do not zig zag all the line
        this.straightLengthWhenZigZag = 5;

        // The length of the zig zag lines
        this.zigZagLength = this.lineLength - this.straightLengthWhenZigZag;
      }

      draw(
        dashType = 1,
        ctx,
        color = "#0ff",
        offsetx = 0,
        offsety = 0,
        lineWidth = 2.0
      ) {
        if (this.dashed) {
          switch (dashType) {
            case 1:
              ctx.setLineDash([12, 4]);
              break;
            case 2:
              ctx.setLineDash([15, 3, 3, 3]);
              break;
            case 3:
              ctx.lineCap = "round";
              lineWidth = 1;
              ctx.setLineDash([0, 6]);
              break;
            case 4:
              ctx.setLineDash([0, 5]);
              ctx.lineCap = "round";
              lineWidth = 3;
              break;
            default:
              ctx.setLineDash([12, 4]);
              break;
          }
        } else {
          ctx.setLineDash([]);
        }

        if (this.zigZagged) {
          this.drawZigZagged(ctx, offsetx, offsety);
        } else {
          ctx.beginPath();
          ctx.moveTo(this.from.x + offsetx, this.from.y + offsety);
          ctx.lineTo(this.to.x + offsetx, this.to.y + offsety);
        }
        ctx.lineWidth = lineWidth;
        ctx.strokeStyle = color;

        ctx.stroke();
        ctx.lineCap = "butt"; //reset
        ctx.setLineDash([]);
      }

      drawZigZagged(ctx, offsetx = 0, offsety = 0) {
        // Save the current drawing state
        ctx.save();

        // Begin the new path
        ctx.beginPath();

        //Set the new 0, 0
        ctx.translate(this.from.x + offsetx, this.from.y + offsety);

        // Rotate the canvas so we can treat it like straight
        ctx.rotate(this.lineRadians);

        // Begin from 0, 0 (ie this.from.x, this.from.y)
        ctx.moveTo(0, 0);
        let zx = 0;
        // Create zig zag lines
        for (let n = 0; zx < this.zigZagLength; n++) {
          // The new zig zag x position
          zx = (n + 1) * this.zigzagSpacing;

          // The new zig zag y position - each and other time up and down
          const zy =
            n % 2 == 0 ? -this.oneZigZagLength : this.oneZigZagLength;

          // Draw the an actual line of the zig zag line
          ctx.lineTo(zx, zy);
        }
        // Back to the center vertically
        ctx.lineTo(this.lineLength - this.straightLengthWhenZigZag / 2, 0);

        // Draw the last bit straight
        ctx.lineTo(this.lineLength, 0);

        // Restore the previous drawing state
        ctx.restore();
      }

      setDashed(enable) {
        this.dashed = enable;
      }

      setZigZagged(enable) {
        this.zigZagged = enable;
      }
    }

    const muestraErrorDiv = document.getElementById("muestraError");
    let alfabetoElegido = [];
    let canvas = document.getElementById("arbolCanvas");
    canvas.style.position = "absolute";
    let ctx = canvas.getContext("2d");

    var length = 6;
    // forma de estrella
    const estrellaCanvas = document.createElement("canvas");
    const estrella = estrellaCanvas.getContext("2d");
    estrellaCanvas.width = length * 3;
    estrellaCanvas.height = length * 3;
    estrella.fillStyle = "transparent";
    estrella.translate(length, length);
    estrella.beginPath();
    estrella.globalAlpha = 1;
    estrella.rotate((Math.PI / 180) * 72);
    estrella.scale(1, 1);
    estrella.strokeStyle = color1;
    estrella.fillStyle = color1;
    estrella.lineWidth = 1;
    for (var i = 5; i--;) {
      estrella.lineTo(0, length);
      estrella.translate(0, length);
      estrella.rotate((Math.PI * 2) / 10);
      estrella.lineTo(0, -length);
      estrella.translate(0, -length);
      estrella.rotate(-((Math.PI * 6) / 10));
    }
    estrella.lineTo(0, length);
    estrella.closePath();
    estrella.fill();
    estrella.stroke();
    const estrellapattern = ctx.createPattern(estrellaCanvas, "repeat");

    // forma de asterisco
    let lengthnueva = 7;
    const asteriscoCanvas = document.createElement("canvas");
    const asterisco = asteriscoCanvas.getContext("2d");
    asteriscoCanvas.width = length * 3;
    asteriscoCanvas.height = length * 3;
    asterisco.fillStyle = "transparent";
    asterisco.translate((length * 3) / 2, (length * 3) / 2);
    asterisco.beginPath();
    asterisco.globalAlpha = 1;
    //asterisco.rotate((Math.PI / 180) * 72);
    asterisco.scale(1, 1);
    asterisco.strokeStyle = color1;
    asterisco.fillStyle = color1;
    asterisco.lineWidth = 2;
    for (var i = 9; i--;) {
      asterisco.lineTo(0, lengthnueva);
      asterisco.translate(0, lengthnueva);
      //    asterisco.rotate((Math.PI * 2) / 10);
      asterisco.lineTo(0, -lengthnueva);
      asterisco.translate(0, -lengthnueva);
      asterisco.rotate(-((Math.PI / 180) * 40));
    }
    asterisco.lineTo(0, lengthnueva);
    asterisco.closePath();
    asterisco.fill();
    asterisco.stroke();
    const asteriscopattern = ctx.createPattern(asteriscoCanvas, "repeat");

    const karma3Canvas = document.createElement("canvas");
    const karma3 = karma3Canvas.getContext("2d");
    karma3Canvas.width = length * 3;
    karma3Canvas.height = length * 3;
    karma3.fillStyle = "transparent";
    karma3.translate((length * 3) / 2, (length * 3) / 2);
    karma3.beginPath();
    karma3.globalAlpha = 1;
    //karma3.rotate((Math.PI / 180) * 72);
    karma3.scale(1, 1);
    karma3.strokeStyle = colorKarmaTriplicado;
    karma3.fillStyle = colorKarmaTriplicado;
    karma3.lineWidth = 2;
    for (var i = 9; i--;) {
      karma3.lineTo(0, lengthnueva);
      karma3.translate(0, lengthnueva);
      //    karma3.rotate((Math.PI * 2) / 10);
      karma3.lineTo(0, -lengthnueva);
      karma3.translate(0, -lengthnueva);
      karma3.rotate(-((Math.PI / 180) * 40));
    }
    karma3.lineTo(0, lengthnueva);
    karma3.closePath();
    karma3.fill();
    karma3.stroke();
    const karma3pattern = ctx.createPattern(karma3Canvas, "repeat");

    // //esto es solo para probar cómo se ve en pantalla
    for (let y = 1; y <= 22; y++) {
      let zig = false;
      let disc = false;
      // dibujaLinea(y, color1, zig, disc, 4);
      // dibujaLinea(y, color1, zig, disc, 2);
      ///dibujaLinea(y, color1, zig, disc, 3);
      // dibujaLinea(y, color1, zig, disc, 3);
      //dibujaLinea(y, color1, zig, disc, 4);

      //poneSimboloSuma(y);
      //poneSimboloSumaduplicado(y);
      // if (y % 2 == 1) dibujaKarma(y);
      // else dibujaKarmaDuplicado(y);
    }
    clear();
    ponecirculos();
    //ponenumerosendero();
    //dibujaRecuadro();
    const apellido2Pchek = document.getElementById("apellido2Pchek");
    const apellido2Mchek = document.getElementById("apellido2Mchek");

    const apellido2P = document.getElementById("apellido2P");
    const apellido2M = document.getElementById("apellido2M");
    var inputletra = document.getElementsByClassName("inputletra");
    for (let t = 0; t < inputletra.length; t++) {
      inputletra[t].onfocus = function () {
        this.value = "";
      };
      inputletra[t].onchange = function (e) {
        clear();
        if (this.name == "nombre") v_nombre = this.value;

        if (this.name == "apellido") v_apellido1 = this.value;
        if (this.name == "apellido2") v_apellido2 = this.value;
        if (this.name == "dia") {
          var d = new Date(this.value + "T00:00:00");
          v_año = d.getFullYear();
          v_mes = d.getMonth() + 1;
          v_dia = d.getDate();
          // console.log(v_dia, v_mes, v_año);
        }
        if (apellido2P.value == "Segundo apellido paterno") {
          apellido2P.value = "";
        }
        else {
          apellido2P.value = desglosar(apellido2P.value)[0];
        }
        if (apellido2M.value == "Segundo apellido materno") {
          apellido2M.value = "";
        }
        else {
          apellido2M.value = desglosar(apellido2M.value)[0];
        }

        // console.log(v_nombre && v_apellido1 && v_apellido2 && v_dia);

        if (v_nombre && v_apellido1 && v_apellido2 && v_dia) {
          Dshevastan();
          llenarFicha();
          inputletra[0].value = v_nombre;
          inputletra[1].value = v_apellido1;
          inputletra[2].value = v_apellido2;
          TalentoKarma();
          dibujarFicha();

          //console.log(ficha);
          //console.log(fichaConSectreto);
        }
        muestraErrorDiv.innerHTML = muestraError;
        //setTimeout(resultado, 10);
      };
    }
    // const radioBtns = document.querySelectorAll('input[name="alfabeto"]');
    // radioBtns.forEach((radioBtn) => {
    //     radioBtn.addEventListener("change", () => {
    //         v_alfabeto = document.querySelector(
    //             'input[name="alfabeto"]:checked'
    //         ).value;
    //         console.log(v_alfabeto);

    //         if (v_nombre && v_apellido1 && v_apellido2 && v_dia) {
    //             llenarFicha();
    //             inputletra[0].value = v_nombre;
    //             inputletra[1].value = v_apellido1;
    //             inputletra[2].value = v_apellido2;
    //             clear();
    //             dibujarFicha();
    //             //console.log(ficha);
    //             //console.log(fichaConSectreto);
    //         }
    //         muestraErrorDiv.innerHTML = muestraError;
    //     });
    // });

    const miSelect = document.getElementById("alfabeto");
    miSelect.addEventListener("change", function () {
      v_alfabeto = miSelect.value;
      //console.log(v_alfabeto);

      if (v_nombre && v_apellido1 && v_apellido2 && v_dia) {
        Dshevastan();
        llenarFicha();
        inputletra[0].value = v_nombre;
        inputletra[1].value = v_apellido1;
        inputletra[2].value = v_apellido2;
        clear();
        TalentoKarma();
        dibujarFicha();

        //console.log(ficha);
        //console.log(fichaConSectreto);
      }
      muestraErrorDiv.innerHTML = muestraError;
    });




    // apellido2Pchek.onchange = function (element) {
    apellido2Pchek.addEventListener("change", function (element) {


      clear();
      Dshevastan();
      llenarFicha();
      TalentoKarma();
      dibujarFicha();


    }); apellido2Mchek.addEventListener("change", function (element) {


      clear();
      Dshevastan();
      llenarFicha();
      TalentoKarma();
      dibujarFicha();


    });


  </script>
</body>

</html>